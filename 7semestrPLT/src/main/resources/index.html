<html>
    <head>
        <title>PLT</title>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
        <script
                src="https://code.jquery.com/jquery-3.1.1.min.js"
                integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
                crossorigin="anonymous"></script>
        <script src="semantic/dist/semantic.min.js"></script>
    </head>
    <body>
        <div class="main ui container">
            <div class="ui form">
                <div class="field">
                    <input type="text" placeholder="alphabet" id="alphabet">
                    <div class="ui pointing red basic label" id="alphabet_message" style="display: None">
                    </div>
                </div>
                <div class="field">
                    <input type="text" placeholder="first str" id="initStr">
                    <div class="ui pointing red basic label" id="initStr_message" style="display: None">
                    </div>
                </div>
                <div class="field">
                    <input type="text" placeholder="last str" id="finalStr">
                    <div class="ui pointing red basic label" id="finalStr_message" style="display: None">
                    </div>
                </div>
                <div class="field">
                    <input type="number" placeholder="multiplicity" id="multiplicity">
                    <div class="ui pointing red basic label" id="multiplicity_message" style="display: None">
                    </div>
                </div>
                <div class="field">
                    <select id="typeRegular">
                        <option value="rightLinear">Right Linear</option>
                        <option value="leftLinear">Left Linear</option>
                    </select>
                </div>
                <div class="ui button" onclick="test()">OK</div>
                <div class="two fields">
                    <div class="field">
                        <input type="number" id="minSize">
                        <div class="ui pointing red basic label" id="minSize_message" style="display: None">
                        </div>
                    </div>
                    <div class="field">
                        <input type="number" id="maxSize">
                        <div class="ui pointing red basic label" id="maxSize_message" style="display: None">
                        </div>
                    </div>
                </div>
                <div class="ui button" onclick="generateStr()">Generate</div>
                <textarea id="area"></textarea>
            </div>
        </div>


        <script>
            function generateStr() {
                if(document.getElementById("minSize").value < 1) {
                    document.getElementById("minSize_message").style.display = "table"
                    document.getElementById("minSize_message").innerText = "Not input!"
                    return
                } else document.getElementById("minSize_message").style.display = "none"

                if(document.getElementById("maxSize").value < 1) {
                    document.getElementById("maxSize_message").style.display = "table"
                    document.getElementById("maxSize_message").innerText = "Not input!"
                    return
                } else document.getElementById("maxSize_message").style.display = "none"

                let xhr = new XMLHttpRequest();
                xhr.open('GET', '/stringsGrammar?'+'grammar='+document.getElementById("area").value.split("\n").reduce((a, b) => {return a + "ENDLINE" + b})+'&'+'minSize='+document.getElementById("minSize").value+'&'+'maxSize='+document.getElementById("maxSize").value)
                xhr.onload = () => {
                    if(xhr.responseText.length > 5000) document.getElementById("area").value = xhr.responseText.substr(0, 5000) + "...and other"
                    else document.getElementById("area").value = xhr.responseText
                }
                xhr.send()
            }
            function test() {
                let xhr = new XMLHttpRequest();
                let setAlphabet =  (new Set(document.getElementById("alphabet").value))
                if(document.getElementById("alphabet").value.length > setAlphabet.size) {
                    document.getElementById("alphabet_message").style.display = "table"
                    document.getElementById("alphabet_message").innerText = "Character repeated!"
                    return
                } else if(document.getElementById("alphabet").value.length < 1) {
                    document.getElementById("alphabet_message").style.display = "table"
                    document.getElementById("alphabet_message").innerText = "Alphabet not input!"
                    return
                } else document.getElementById("alphabet_message").style.display = "none"

                if(document.getElementById("multiplicity").value < 1) {
                    document.getElementById("multiplicity_message").style.display = "table"
                    document.getElementById("multiplicity_message").innerText = "Not input!"
                    return
                } else document.getElementById("multiplicity_message").style.display = "none"

                for(let value of document.getElementById("initStr").value){
                    if(!setAlphabet.has(value)) {
                        document.getElementById("initStr_message").style.display = "table"
                        document.getElementById("initStr_message").innerText = "Symbol " + value + " missing in alphabet!"
                        return
                    }
                }
                document.getElementById("initStr_message").style.display = "none"

                for(let value of document.getElementById("finalStr").value){
                    if(!setAlphabet.has(value)) {
                        document.getElementById("finalStr_message").style.display = "table"
                        document.getElementById("finalStr_message").innerText = "Symbol " + value + " missing in alphabet!"
                        return
                    }
                }
                document.getElementById("finalStr_message").style.display = "none"

                xhr.open('GET', '/regularGrammar?' + 'alphabet=' + document.getElementById("alphabet").value + '&initStr=' + document.getElementById("initStr").value + '&finalStr=' + document.getElementById("finalStr").value + '&multiplicity=' + document.getElementById("multiplicity").value + '&typeRegularGrammar=' + document.getElementById("typeRegular").selectedOptions[0].value )
                xhr.onload = () => {
                    document.getElementById("area").value = xhr.responseText
                }
                xhr.send()
            }
        </script>
    </body>
</html>